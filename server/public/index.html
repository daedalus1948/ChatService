<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
    <link rel="stylesheet" type="text/css" href="index.css">
  </head>
  <body>

    <div class="main">
      <div class="header"></div>
      
      <div class="content">

          <div class="leftbar"></div>

          <div class="chat"></div>
          
          <div class="rightbar">

            <div class="entity">
              <input id="change-name"></input>
              <button id="change-name-but">change name</button>
            </div>

            <div class="entity">
              <input id="change-color"></input>
              <button id="change-color-but">change color</button>
            </div>

            <div class="entity">
              <button id="disconnect">disconnect</button>
            </div>

          </div>
            
      </div>

    <div class="footer">

        <div class="entity">
          <form>
            <input id="send-message"></input>
            <button id="send-but">send</button>
          </form>
        </div>

      </div>

    </div>

    <script>
      document.getElementById('change-color-but').addEventListener('click', (e)=>{
        e.preventDefault();
        let data = document.getElementById('change-color').value;
        socket.emit('action', {type:'change_color', property:'color', data: data});
      })

      document.getElementById('change-name-but').addEventListener('click', (e)=>{
        e.preventDefault();
        let data = document.getElementById('change-name').value;
        socket.emit('action', {type:'change_name', property:'name', data: data});
      })

      document.getElementById('send-but').addEventListener('click', (e)=>{
        e.preventDefault();
        let dataInput = document.getElementById('send-message');
        let data = dataInput.value;
        dataInput.value = '';
        socket.emit('action', {type:'send_message', data: data});
      })

      document.getElementById('disconnect').addEventListener('click', (e)=>{
        e.preventDefault();
        socket.disconnect();
      })


      const socket = io.connect('http://127.0.0.1:4000');
      socket.on('action', (data)=>{
        document.body.getElementsByClassName('leftbar')[0].innerHTML = '';
        document.body.getElementsByClassName('chat')[0].innerHTML = '';
        
        Object.values(data.users).forEach((userData)=>{
              let User = document.createElement("div"); 
              User.className = 'user';
              User.style.color = userData.color;
              let newContent = document.createTextNode(userData.name); 
              User.appendChild(newContent);
              document.body.getElementsByClassName('leftbar')[0].appendChild(User); 
            });


        data.messages.forEach((message)=>{
          let Message = document.createElement("div"); 
              Message.className = 'message';
              Message.style.color = message.color;
              let userId = document.createTextNode(message.userId);
              let timestamp = document.createTextNode(message.timestamp);
              let semicolon = document.createTextNode(':');  
              let data = document.createTextNode(message.data); 
              Message.appendChild(userId);
              Message.appendChild(semicolon);
              Message.appendChild(timestamp);
              Message.appendChild(semicolon);
              Message.appendChild(data);
              document.body.getElementsByClassName('chat')[0].appendChild(Message); 
        })
    })
    </script>
  </body>
</html>

